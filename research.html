<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stock Buy Decision Helper</title>
<style>
  body {
    background-color: #1e1e1e;
    color: #eee;
    font-family: Arial, sans-serif;
    max-width: 350px;
    margin: 20px auto;
    padding: 10px;
  }
  input, button {
    padding: 10px;
    margin: 5px 0;
    width: 100%;
    border-radius: 5px;
    border: none;
    font-size: 16px;
  }
  button {
    background-color: #e91e63;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background-color: #ad1457;
  }
  .result {
    margin-top: 20px;
    background-color: #2c2c2c;
    padding: 15px;
    border-radius: 8px;
  }
  .metric {
    margin-bottom: 10px;
  }
  .metric strong {
    display: block;
    font-size: 14px;
    color: #e91e63;
  }
  .verdict {
    margin-top: 20px;
    font-size: 18px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h2>Stock Buy Decision Helper</h2>

<input id="stockSymbol" type="text" placeholder="Enter Stock Symbol (e.g. AAPL)" />
<button id="fetchBtn">Check Stock</button>

<div id="output" class="result" style="display:none;"></div>

<script>
  const apiKey = "d151vgpr01qntv1fni6gd151vgpr01qntv1fni70";

  document.getElementById("fetchBtn").addEventListener("click", async () => {
    const symbol = document.getElementById("stockSymbol").value.trim().toUpperCase();
    if (!symbol) {
      alert("Please enter a stock symbol.");
      return;
    }
    document.getElementById("output").style.display = "none";
    document.getElementById("output").innerHTML = "Loading...";

    try {
      // Fetch quote data (price)
      const quoteRes = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`);
      const quote = await quoteRes.json();

      // Fetch metric data (PE, growth, dividend, debt/equity)
      const metricRes = await fetch(`https://finnhub.io/api/v1/stock/metric?symbol=${symbol}&metric=all&token=${apiKey}`);
      const metricData = await metricRes.json();

      if (quote.c === 0 || !metricData.metric) {
        document.getElementById("output").innerHTML = "No data found for this symbol.";
        return;
      }

      const metrics = metricData.metric;

      // Calculate 1 year price return from quote c (current price) and metric['52WeekHigh'] or metric['52WeekLow']
      // Finnhub metric doesn't have 1yr return directly, so we approximate using 52-week high and low or you could skip

      // We'll use metric['52WeekHigh'] and metric['52WeekLow'] as a rough range, and estimate
      // But to keep it simple, let's skip and just display current price

      // Format numbers with commas and 2 decimals
      const fmtNum = (n) => n ? n.toLocaleString(undefined, {maximumFractionDigits:2}) : "N/A";
      const fmtPct = (n) => n ? (n*100).toFixed(2) + "%" : "N/A";

      // Extract needed data
      const price = quote.c;
      const peRatio = metrics.peNormalizedAnnual ?? metrics.peAnnual ?? null;
      const epsGrowth = metrics.epsGrowth ?? null;
      const dividendYield = metrics.dividendYieldIndicatedAnnual ?? null;
      const debtEquity = metrics.debtToEquityAnnual ?? null;

      // Build verdict based on some simple heuristics
      let verdict = "";
      let score = 0;

      if (peRatio && peRatio < 20) score++;
      if (epsGrowth && epsGrowth > 0) score++;
      if (dividendYield && dividendYield > 0.02) score++;
      if (debtEquity && debtEquity < 1) score++;

      if (score >= 3) verdict = "Good candidate for buying üëç";
      else if (score == 2) verdict = "Maybe worth buying, do more research ü§î";
      else verdict = "Consider waiting or researching more ‚ö†Ô∏è";

      // Render output
      document.getElementById("output").style.display = "block";
      document.getElementById("output").innerHTML = `
        <div class="metric"><strong>Current Price:</strong> $${fmtNum(price)}</div>
        <div class="metric"><strong>PE Ratio:</strong> ${fmtNum(peRatio)}</div>
        <div class="metric"><strong>EPS Growth Estimate:</strong> ${fmtPct(epsGrowth)}</div>
        <div class="metric"><strong>Dividend Yield:</strong> ${fmtPct(dividendYield)}</div>
        <div class="metric"><strong>Debt to Equity Ratio:</strong> ${fmtNum(debtEquity)}</div>
        <div class="verdict">${verdict}</div>
      `;

    } catch (error) {
      document.getElementById("output").style.display = "block";
      document.getElementById("output").innerHTML = "Error fetching stock data.";
      console.error(error);
    }
  });
</script>

</body>
</html>
